#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Commit message validation hook
# Enforces conventional commit format and quality standards

commit_file="$1"
commit_msg=$(cat "$commit_file")

echo "üìù Validating commit message..."

# Check minimum length
if [ ${#commit_msg} -lt 10 ]; then
  echo "‚ùå Commit message too short. Minimum 10 characters required."
  echo "Current message: '$commit_msg'"
  exit 1
fi

# Check maximum length for first line
first_line=$(echo "$commit_msg" | head -n1)
if [ ${#first_line} -gt 72 ]; then
  echo "‚ùå First line too long. Maximum 72 characters allowed."
  echo "Current length: ${#first_line}"
  echo "First line: '$first_line'"
  exit 1
fi

# Check for conventional commit format (optional but recommended)
if echo "$first_line" | grep -qE "^(feat|fix|docs|style|refactor|perf|test|chore|build|ci)(\(.+\))?: .+"; then
  echo "‚úÖ Conventional commit format detected."
else
  echo "‚ö†Ô∏è  Consider using conventional commit format:"
  echo "   feat: add new feature"
  echo "   fix: fix bug"
  echo "   docs: update documentation"
  echo "   style: formatting changes"
  echo "   refactor: code refactoring"
  echo "   perf: performance improvements"
  echo "   test: add or update tests"
  echo "   chore: maintenance tasks"
  echo "   build: build system changes"
  echo "   ci: CI/CD changes"
fi

# Check for common issues
if echo "$commit_msg" | grep -qi "wip\|work in progress"; then
  echo "‚ö†Ô∏è  WIP commit detected. Consider completing the work before committing."
fi

if echo "$commit_msg" | grep -qi "temp\|temporary\|tmp"; then
  echo "‚ö†Ô∏è  Temporary commit detected. Consider providing a more descriptive message."
fi

if echo "$first_line" | grep -q "\.$"; then
  echo "‚ö†Ô∏è  First line ends with period. Consider removing it for consistency."
fi

# Check for ticket/issue references
if echo "$commit_msg" | grep -qE "#[0-9]+|[A-Z]+-[0-9]+"; then
  echo "‚úÖ Issue/ticket reference found."
fi

# Encourage descriptive messages
if [ ${#first_line} -lt 20 ]; then
  echo "üí° Consider adding more detail to your commit message."
fi

echo "‚úÖ Commit message validation passed!"
exit 0